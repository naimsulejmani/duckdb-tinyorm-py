name: Publish Python Package

on:
  release:
    types: [created]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.x"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install poetry

      - name: Check PyPI token is present
        run: |
          if [ -z "${{ secrets.PYPI_TOKEN }}" ]; then
            echo "PYPI_TOKEN secret is NOT available to this workflow run."
            exit 1
          else
            echo "PYPI_TOKEN secret is available."
          fi

      - name: Show version
        run: |
          poetry version
          grep -n 'version' pyproject.toml

      - name: Build and publish
        env:
          PYPI_TOKEN: ${{ secrets.PYPI_TOKEN }}
        run: |
          poetry config pypi-token.pypi "$PYPI_TOKEN"
          poetry build
          poetry publish
# name: Publish Python Package

# on:
#   release:
#     types: [created]

# jobs:
#   deploy:
#     runs-on: ubuntu-latest
#     steps:
#     - uses: actions/checkout@v3
#     - name: Set up Python
#       uses: actions/setup-python@v4
#       with:
#         python-version: '3.x'
#     - name: Install dependencies
#       run: |
#         python -m pip install --upgrade pip
#         pip install poetry
#     - name: Build and publish
#       env:
#         PYPI_TOKEN: ${{ secrets.PYPI_TOKEN }}
#       run: |
#         poetry config pypi-token.pypi "$PYPI_TOKEN"
#         poetry build
#         poetry publish